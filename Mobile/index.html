<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- NAVBAR -->

    <nav>
      <div class="nav-wrapper blue lighten-2">
        <a href="#" class="brand-logo center">TODOlist</a>
      </div>
    </nav>

    <!-- INPUT BLOCK -->

    <div class="row">
      <div class="input-field col s9">
        <input value="" id="TaskImput" type="text" class="validate" />
        <label class="active" for="first_name2">новая запись</label>
      </div>

      <div class="input-field col s3">
        <a
          class="btn-floating btn-large waves-effect waves-light blue darken-1"
          onclick="createTask()"
          id="addButton"
          ><i class="material-icons">add</i></a
        >
      </div>
    </div>

    <!-- TASK LIST -->

    <ul class="collection with-header" id="TaskListContainer"></ul>

    <script>
      let TaskItems = [];
      const TaskListContainer = document.getElementById("TaskListContainer");
      const CopyTaskListContainer = TaskListContainer;
      document.addEventListener("DOMContentLoaded", renderList());

      function renderList() {
        let task = "";
        let strike_open = "";
        let strike_close = "";
        TaskItems.forEach((TaskItem, i) => {
          if (TaskItem.isComplete) {
            strike_open = "<s>";
            strike_close = "</s>";
          } else {
            strike_open = "";
            strike_close = "";
          }
          task += `
            <li class="collection-item">
                <div><span onclick='strikeTask(${i})'>${strike_open}${TaskItem.text}${strike_close}</span>
                    <a href="#!" class="secondary-content">

                        <button class="waves-effect waves-light btn-small blue darken-1"
                        type="submit" name="action"
                        onclick='edditTask(${i})'>
                            <i class="material-icons" id= " ">border_color</i>
                        </button>

                        <button
                        class="waves-effect waves-light btn-small blue darken-1"
                        type="submit" name="action"
                        onclick="delTask(${i})">
                            <i class="material-icons" >delete</i>
                        </button>

                    </a>
                </div>
            </li>`;
        });
        TaskListContainer.innerHTML = task;
      }
      function createTask() {
        const text = document.getElementById("TaskImput").value;
        if (text) {
          const task = {
            id: "_" + Math.random().toString(36).substr(2, 9),
            text: text,
            isComplete: false,
          };

          TaskItems.push(task);
          document.getElementById("TaskImput").value = "";
          renderList();
        } else {
          return;
        }
      }
      document.addEventListener("keydown", function (event) {
        if (event.keyCode === 13) {
          createTask();
        }
      });
      function delTask(i) {
        TaskItems.splice(i, 1);
        renderList();
        return;
      }
      function edditTask(i) {
        let container_sayver = TaskListContainer.innerHTML;
        let old_task_text = TaskItems[i].text;
        TaskListContainer.innerHTML = `
        <div class="row">
          <div class="input-field col s9">
            <input value="${old_task_text}" id="EdditTaskImput" type="text" class="validate" />
            <label class="active" for="first_name2">редактировать запись</label>
          </div>

          <div class="input-field col s3">
            <a
              class="btn-floating btn-large waves-effect waves-light deep-purple lighten-3"
              onclick="task_after_eddit(${i})"
              id="addButton"
              ><i class="material-icons">add</i></a
            >
          </div>
        </div>
        `;
        TaskListContainer.innerHTML =
          container_sayver + TaskListContainer.innerHTML;
        return;
      }

      function task_after_eddit(i) {
        const text = document.getElementById("EdditTaskImput").value;
        TaskItems[i].text = text;
        renderList();
      }
      function strikeTask(i) {
        let bul = !TaskItems[i].isComplete;
        TaskItems[i].isComplete = bul;
        renderList();
        return;
      }
    </script>
  </body>
</html>
